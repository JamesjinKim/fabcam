# Fabcam - Raspberry Pi 4 CCTV System PRD
## Product Requirements Document

### 문서 정보
- **프로젝트명**: Fabcam CCTV System
- **버전**: 1.0.0
- **작성일**: 2025-08-08
- **대상 플랫폼**: Raspberry Pi 4
- **문서 유형**: Product Requirements Document (PRD)

---

## 1. 프로젝트 개요

### 1.1 목표
라즈베리파이4와 카메라 모듈을 활용하여 오프라인 환경에서 동작하는 간단하고 효율적인 CCTV 시스템을 구축한다.

### 1.2 배경
- 인터넷 연결이 제한적인 환경에서도 사용 가능한 보안 시스템 필요
- 클라우드 의존성 없는 완전한 로컬 솔루션 구현
- 라즈베리파이 하드웨어의 성능을 최대한 활용한 경제적인 CCTV 솔루션

### 1.3 운영 환경
- **하드웨어**: Raspberry Pi 4
- **카메라**: Raspberry Pi Camera Module 또는 USB 카메라
- **네트워크**: 로컬 네트워크 (인터넷 연결 불필요)
- **운영체제**: Raspberry Pi OS (Linux 기반)
- **접근 방식**: 웹 브라우저를 통한 접근

---

## 2. 기술 스택

### 2.1 백엔드
- **언어**: Python 3
- **프레임워크**: FastAPI 0.104.1
- **웹서버**: Uvicorn 0.24.0
- **영상 처리**: OpenCV 4.8.1.78
- **파일 처리**: aiofiles 23.2.1
- **템플릿 엔진**: Jinja2 3.1.2

### 2.2 프론트엔드
- **마크업**: HTML5
- **스타일링**: CSS3 (반응형 디자인)
- **스크립트**: Vanilla JavaScript (ES6+)
- **UI/UX**: 모던 다크 테마, 직관적 인터페이스

### 2.3 인프라
- **저장소**: 로컬 파일 시스템
- **미디어 포맷**: 
  - 비디오: AVI (XVID 코덱)
  - 이미지: JPEG
  - 스트리밍: MJPEG
- **포트**: 8000 (HTTP)

---

## 3. 주요 기능 명세

### 3.1 실시간 영상 스트리밍 📹
**기능 설명**: 카메라에서 실시간 영상을 캡처하여 웹 브라우저에 스트리밍

**기술 구현**:
- OpenCV를 통한 카메라 프레임 캡처
- MJPEG 방식의 HTTP 스트리밍 (`/video_feed` 엔드포인트)
- 해상도: 640x480 픽셀
- 프레임레이트: 10 FPS (스트리밍), 30 FPS (카메라 캡처)

**사용자 경험**:
- 웹페이지 로드 시 자동으로 스트리밍 시작
- 연결 오류 시 재시도 버튼 제공
- 실시간 연결 상태 표시

### 3.2 비디오 녹화 🎬
**기능 설명**: 사용자 제어에 따른 비디오 녹화 시작/정지

**기술 구현**:
- 별도 스레드에서 비디오 녹화 처리
- 20 FPS로 AVI 파일 생성 (XVID 코덱)
- 파일명: `recording_YYYYMMDD_HHMMSS.avi` 형식
- 녹화 상태 실시간 모니터링

**사용자 경험**:
- 원클릭 녹화 시작/정지
- 녹화 중 시각적 인디케이터 (깜박이는 빨간 점)
- 녹화된 파일 자동으로 파일 목록에 추가

### 3.3 스냅샷 촬영 📸
**기능 설명**: 현재 화면을 이미지로 즉시 캡처

**기술 구현**:
- 현재 프레임을 JPEG 형식으로 저장
- 파일명: `snapshot_YYYYMMDD_HHMMSS.jpg` 형식
- 고품질 이미지 압축 (품질: 기본값)

**사용자 경험**:
- 버튼 클릭으로 즉시 스냅샷 촬영
- 촬영 완료 시 토스트 알림 표시
- 촬영된 이미지 자동으로 파일 목록에 추가

### 3.4 파일 관리 시스템 📁
**기능 설명**: 저장된 미디어 파일의 조회, 다운로드, 삭제 관리

**기술 구현**:
- RESTful API를 통한 파일 CRUD 작업
- 파일 메타데이터 (크기, 생성일시, 타입) 제공
- 직접 파일 다운로드 링크 생성

**사용자 경험**:
- 동영상/이미지 필터링 탭
- 파일 크기와 생성시간 표시
- 개별 파일 다운로드 및 삭제 버튼
- 삭제 시 확인 대화상자

### 3.5 웹 기반 사용자 인터페이스 🌐
**기능 설명**: 모든 기능에 접근 가능한 통합 웹 인터페이스

**기술 구현**:
- 반응형 CSS Grid 및 Flexbox 레이아웃
- 다크 테마 디자인 (눈의 피로 최소화)
- JavaScript를 통한 실시간 상태 업데이트
- 키보드 단축키 지원

**사용자 경험**:
- PC와 모바일에서 모두 최적화된 UI
- 직관적인 아이콘과 버튼 배치
- 실시간 피드백 (토스트 메시지, 상태 인디케이터)
- 접근성 고려 (키보드 단축키, 명확한 레이블)

---

## 4. 시스템 아키텍처

### 4.1 전체 구조
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│   Camera        │    │   FastAPI        │    │   Web Browser       │
│   (Hardware)    │────│   Backend        │────│   (Client)          │
│                 │    │                  │    │                     │
│ - RPi Camera    │    │ - HTTP Server    │    │ - Video Display     │
│ - USB Camera    │    │ - MJPEG Stream   │    │ - Control Interface │
└─────────────────┘    │ - File Storage   │    │ - File Management   │
                       └──────────────────┘    └─────────────────────┘
                                │
                         ┌──────────────────┐
                         │   Local Storage  │
                         │                  │
                         │ - static/videos/ │
                         │ - static/images/ │
                         └──────────────────┘
```

### 4.2 데이터 흐름
1. **비디오 스트리밍**: Camera → OpenCV → FastAPI → MJPEG Stream → Browser
2. **녹화**: Camera → OpenCV → Background Thread → AVI File → Local Storage
3. **스냅샷**: Camera → OpenCV → JPEG File → Local Storage
4. **파일 관리**: Local Storage ↔ FastAPI ↔ Browser UI

### 4.3 API 엔드포인트

| Method | Endpoint | 설명 | 응답 |
|--------|----------|------|------|
| GET | `/` | 메인 웹 UI | HTML |
| GET | `/video_feed` | MJPEG 비디오 스트림 | multipart/x-mixed-replace |
| POST | `/api/recording/start` | 녹화 시작 | JSON (파일명) |
| POST | `/api/recording/stop` | 녹화 정지 | JSON (상태) |
| GET | `/api/recording/status` | 녹화 상태 확인 | JSON (상태) |
| POST | `/api/snapshot` | 스냅샷 캡처 | JSON (파일명) |
| GET | `/api/files` | 파일 목록 조회 | JSON (파일 배열) |
| GET | `/api/files/{type}/{filename}` | 파일 다운로드 | Binary File |
| DELETE | `/api/files/{type}/{filename}` | 파일 삭제 | JSON (상태) |

---

## 5. 사용자 경험 (UX) 요구사항

### 5.1 인터페이스 디자인
- **테마**: 다크 모드 (CCTV 모니터링에 적합)
- **색상 체계**: 
  - 기본: #1a1a1a (배경), #ffffff (텍스트)
  - 강조: #4CAF50 (성공), #f44336 (오류), #2196F3 (정보)
- **타이포그래피**: Segoe UI, Tahoma, Geneva (가독성 우선)
- **레이아웃**: Grid 기반 반응형 디자인

### 5.2 상호작용 설계
- **버튼**: 명확한 아이콘과 텍스트 조합
- **피드백**: 즉각적인 시각적/텍스트 피드백
- **오류 처리**: 사용자 친화적 오류 메시지
- **로딩 상태**: 프로그레스 인디케이터

### 5.3 반응형 디자인
- **데스크톱** (>768px): 2열 그리드 레이아웃
- **모바일** (<768px): 1열 스택 레이아웃
- **터치 최적화**: 충분한 터치 타겟 크기 (44px 이상)

### 5.4 접근성
- **키보드 단축키**:
  - `Ctrl+R`: 녹화 토글
  - `Ctrl+S`: 스냅샷
  - `Ctrl+L`: 파일 목록 새로고침
- **시각적 피드백**: 명확한 상태 표시
- **텍스트 레이블**: 모든 인터랙티브 요소에 명확한 레이블

---

## 6. 성능 요구사항

### 6.1 시스템 성능
- **CPU 사용률**: 라즈베리파이 4에서 70% 이하 유지
- **메모리 사용**: 512MB 이하
- **저장소**: 동적 관리 (사용자가 직접 파일 삭제)

### 6.2 네트워크 성능
- **비디오 스트리밍**: 10 FPS, 지연시간 500ms 이하
- **API 응답시간**: 일반 요청 100ms 이하
- **파일 다운로드**: 로컬 네트워크 최대 속도 활용

### 6.3 미디어 품질
- **비디오 해상도**: 640x480 (VGA)
- **비디오 압축**: XVID 코덱, 적절한 품질/용량 균형
- **이미지 품질**: JPEG, 품질 70% (스트리밍), 기본값 (스냅샷)

---

## 7. 보안 및 안정성

### 7.1 보안 고려사항
- **네트워크 격리**: 로컬 네트워크에서만 접근 가능
- **입력 검증**: 모든 API 입력에 대한 유효성 검사
- **파일 시스템**: 지정된 디렉토리 외부 접근 차단
- **오류 처리**: 민감한 정보 노출 방지

### 7.2 안정성 요구사항
- **카메라 오류 복구**: 카메라 연결 실패 시 자동 재시도
- **스토리지 관리**: 디스크 공간 부족 시 사용자 알림
- **세션 관리**: 브라우저 새로고침 시 상태 복원
- **예외 처리**: 모든 예외상황에 대한 적절한 처리

---

## 8. 배포 및 설치

### 8.1 시스템 요구사항
- **하드웨어**: Raspberry Pi 4 (2GB RAM 이상 권장)
- **운영체제**: Raspberry Pi OS (Debian 기반)
- **Python**: 3.7 이상
- **카메라**: Raspberry Pi Camera Module V2 또는 호환 USB 카메라

### 8.2 설치 과정
```bash
# 1. 저장소 클론
git clone https://github.com/JamesjinKim/fabcam.git
cd fabcam

# 2. Python 의존성 설치
pip install -r requirements.txt

# 3. 디렉토리 생성
mkdir -p static/videos static/images

# 4. 서버 시작
./start.sh
```

### 8.3 설정 옵션
- **카메라 인덱스**: 기본값 0 (첫 번째 카메라)
- **해상도**: 640x480 (설정 가능)
- **포트**: 8000 (변경 가능)
- **저장 경로**: static/ 디렉토리 (변경 가능)

---

## 9. 향후 확장 계획

### 9.1 단기 확장 (v1.1)
- **모션 감지**: 움직임 감지 시 자동 녹화
- **이메일 알림**: 중요 이벤트 발생 시 알림
- **스케줄 녹화**: 시간대별 자동 녹화
- **다중 카메라**: 여러 카메라 동시 지원

### 9.2 중기 확장 (v1.5)
- **사용자 인증**: 간단한 로그인 시스템
- **모바일 앱**: 전용 모바일 애플리케이션
- **클라우드 백업**: 선택적 클라우드 저장소 연동
- **AI 분석**: 객체 감지 및 분석

### 9.3 장기 확장 (v2.0)
- **얼굴 인식**: 인증된 사용자 자동 식별
- **스마트 알림**: AI 기반 지능형 알림 시스템
- **원격 접근**: 안전한 원격 접근 기능
- **대시보드**: 상세한 분석 및 리포팅

---

## 10. 성공 지표

### 10.1 기술적 성공 지표
- ✅ 카메라 스트리밍 정상 동작 (지연시간 < 500ms)
- ✅ 녹화/스냅샷 기능 정상 동작
- ✅ 파일 관리 시스템 정상 동작
- ✅ 모든 웹 브라우저에서 호환성 확인

### 10.2 사용자 경험 성공 지표
- ✅ 직관적인 UI/UX (사용법 설명 없이 사용 가능)
- ✅ 모바일 디바이스 완벽 지원
- ✅ 오류 상황에서도 적절한 피드백 제공
- ✅ 24시간 연속 동작 안정성

### 10.3 비즈니스 성공 지표
- 설치 및 설정 시간 30분 이내
- 라즈베리파이 리소스 효율적 사용
- 추가 하드웨어 구매 없이 완전한 CCTV 솔루션 제공
- 오픈소스 커뮤니티 기여 및 피드백 수집

---

## 11. 결론

Fabcam CCTV System은 라즈베리파이4의 성능을 최대한 활용하여 경제적이고 효율적인 보안 솔루션을 제공합니다. 오프라인 환경에서도 완벽하게 동작하며, 사용자 친화적인 웹 인터페이스를 통해 누구나 쉽게 사용할 수 있습니다.

본 시스템은 기본적인 CCTV 기능을 충실히 구현하면서도 향후 확장 가능성을 염두에 두고 설계되었습니다. 모듈화된 구조와 표준 기술 스택을 사용하여 유지보수성과 확장성을 보장합니다.

**핵심 가치 제안**:
- 💰 **경제성**: 저렴한 하드웨어로 완전한 CCTV 솔루션
- 🔒 **보안성**: 완전한 오프라인 동작, 외부 의존성 없음
- 🚀 **편의성**: 설치부터 사용까지 간단한 과정
- 🔧 **확장성**: 필요에 따라 기능 추가 가능한 구조

💡 최소 웹 CCTV 구성

  삭제 후 남겨야 할 최소 파일들:
  FabCam/
  ├── backend/           # 백엔드 (필수)
  │   ├── main.py
  │   ├── camera.py
  │   └── models.py
  ├── frontend/          # 프론트엔드 (필수)
  │   ├── index.html
  │   ├── script.js
  │   └── style.css
  ├── static/            # 저장소 (필수)
  │   ├── images/
  │   └── videos/
  └── start.sh          # 실행 스크립트 (필수)

  실행 방법:
  cd FabCam
  ./start.sh

  접속:
  http://localhost:8000