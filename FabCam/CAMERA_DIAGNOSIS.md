# FabCam 카메라 시스템 진단 보고서

## 문제 요약
- **카메라 0번**: 하드웨어 연결 문제로 스트리밍 불가
- **카메라 1번**: 정상 작동
- **해상도 통일**: 모든 녹화/스트리밍을 640×480:30fps로 통일 완료

## 시스템 현황

### 하드웨어 감지 상태
```bash
$ rpicam-hello --list-cameras
Available cameras
-----------------
0 : ov5647 [2592x1944 10-bit GBRG] (/base/axi/pcie@1000120000/rp1/i2c@88000/ov5647@36)
1 : ov5647 [2592x1944 10-bit GBRG] (/base/axi/pcie@1000120000/rp1/i2c@80000/ov5647@36)
```

### 개별 카메라 테스트 결과

#### 카메라 0번 (문제 발생)
```
ERROR: Camera frontend has timed out!
ERROR: Please check that your camera sensor connector is attached securely.
ERROR: Alternatively, try another cable and/or sensor.
ERROR: Device timeout detected, attempting a restart!!!
```

#### 카메라 1번 (정상)
```
Mode selection for 640:480:12:P(30)
Stream configuration adjusted
Halting: reached timeout of 5000 milliseconds. (정상 종료)
```

## 구현된 개선사항

### 1. 해상도 통일 (완료)
- **스트리밍**: 640×480:30fps (기존 유지)
- **연속 녹화**: 1280×720 → 640×480:30fps 변경
- **수동 녹화**: 1920×1080 → 640×480:30fps 변경

#### 수정된 파일: `camera.py`
```python
# 연속 녹화 해상도 변경 (line 393-394)
"--width", "640",
"--height", "480",

# 수동 녹화 해상도 변경 (line 497-498)  
"--width", "640",
"--height", "480",
```

### 2. 시스템 안정성 검증
- 카메라 1번 정상 스트리밍 확인
- MJPEG 스트림 onload 이벤트는 정상 동작 (각 프레임마다 발생)
- 시스템 리소스 사용량 안정적

## 문제 원인 분석

### 카메라 0번 하드웨어 문제
1. **물리적 연결 불량**: CSI 케이블 접촉 불량 가능성
2. **케이블 결함**: 카메라 케이블 손상 가능성  
3. **카메라 모듈 결함**: 카메라 센서 자체 문제 가능성

### 소프트웨어는 정상
- libcamera 정상 감지 및 초기화
- 시스템 코드에 오류 없음
- 카메라 1번으로 정상 작동 확인

## 권장 해결방안

### 즉시 조치 (하드웨어)
1. **CSI 케이블 재연결**
   - 라즈베리파이와 카메라 모듈의 CSI 케이블 분리 후 재연결
   - 케이블 방향 및 고정 상태 확인

2. **케이블 교체**
   - 새로운 CSI 케이블로 교체 시도
   - 케이블 길이 및 품질 확인

3. **카메라 모듈 교체**
   - 가능하다면 카메라 0번 모듈 교체
   - 또는 카메라 1번과 위치 교환하여 문제 모듈 식별

### 소프트웨어 모니터링
현재 시스템은 안정적이므로 추가 소프트웨어 수정 불필요:
- 자동 재시작 로직 추가하지 않음 (시스템 불안정 야기)
- 에러 처리는 현재 수준으로 충분
- 카메라 1번 정상 작동 유지

## 시스템 상태 요약

| 구성요소 | 상태 | 비고 |
|---------|------|------|
| 카메라 0번 | ❌ 하드웨어 문제 | 물리적 점검 필요 |
| 카메라 1번 | ✅ 정상 | 안정적 스트리밍 |
| 해상도 통일 | ✅ 완료 | 640×480:30fps |
| 시스템 안정성 | ✅ 양호 | 추가 수정 불필요 |

## 결론

**카메라 0번 문제는 하드웨어 결함으로 확인되었으며, 소프트웨어 수정으로는 해결 불가능합니다.**

물리적 하드웨어 점검 및 교체 후 시스템이 정상 작동할 것으로 예상됩니다.

---
*진단 완료: 2025-08-22*  
*시스템 버전: FabCam CCTV v2.0.0*